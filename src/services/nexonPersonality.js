// src/services/nexonPersonality.js - Nexon Digital Tutor Personality
// Based on: ××“×¨×™×š ×”×”×•×¨××” ×œ××•×¨×” ×”×“×™×’×™×˜×œ×™ "× ×§×¡×•×Ÿ"

/**
 * Nexon Personality Service
 * Implements the warm, adaptive, and emotionally intelligent teaching style
 * as defined in the Nexon teaching methodology
 */

class NexonPersonality {
    constructor() {
        this.lessonPhase = 'opening'; // opening, middle, closing
        this.lastInteraction = Date.now();
    }

    // ==========================================
    // OPENING PHASE - Energetic & Inviting
    // ==========================================
    getOpeningMessage(studentName = '') {
        const name = studentName || '×©×œ×•×';
        const messages = [
            `×”×™×™ ${name}! ğŸŒŸ ××•×›×Ÿ/×” ×œ×”×ª×—×™×œ ×”×¨×¤×ª×§×” ××ª××˜×™×ª ×—×“×©×”?`,
            `×©×œ×•× ${name}! ××™×–×” ×›×™×£ ×©×—×–×¨×ª! ×‘×•×/×™ × ×¨××” ××©×”×• ××’× ×™×‘ ×”×™×•× ğŸš€`,
            `${name}, ×™×© ×œ×™ ×‘×©×‘×™×œ×š ××©×”×• ××¢× ×™×™×Ÿ ×”×™×•×! ××•×›×Ÿ/×” ×œ××ª×’×¨? ğŸ’ª`,
            `×‘×¨×•×š ×”×‘× ${name}! ×‘×•××• × ×’×œ×” ××©×”×• ×—×“×© ×‘×™×—×“ ğŸ¯`,
            `×”×™×™ ${name}! ××™×š ××ª×” ××¨×’×™×© ×”×™×•×? ×‘×•× × ×¢×©×” ××©×”×• ×›×™×™×¤×™ ×‘××ª××˜×™×§×”! âœ¨`
        ];
        return messages[Math.floor(Math.random() * messages.length)];
    }

    getOpeningQuestion(topic) {
        const questions = [
            `× ×—×©×• ××”? ${topic} ×–×” ×‘×¢×¦× ×“×™ ××’× ×™×‘! ×¨×•×¦×™× ×œ×¨××•×ª ×œ××”?`,
            `×¡×¤×¨×• ×œ×™, ××” ××ª× ×™×•×“×¢×™× ×¢×œ ${topic}?`,
            `${topic} - × ×©××¢ ××¡×•×‘×š? ×‘×•××• × ×¨××” ×©×–×” ×‘×¢×¦× ×¤×©×•×˜!`,
            `×”×™×•× × ×œ××“ ×¢×œ ${topic}. ××” ××ª× ×—×•×©×‘×™×, ××™×¤×” ×–×” ×©×™××•×©×™ ×‘×—×™×™×?`
        ];
        return questions[Math.floor(Math.random() * questions.length)];
    }

    // ==========================================
    // MIDDLE PHASE - Adaptive & Supportive
    // ==========================================
    getMiddleMessage(progress, studentName = '') {
        const name = studentName || '××ª×”';

        if (progress < 20) {
            return [
                `×× ×™ ×¨×•××” ×©${name} ××ª×—×™×œ/×” ×œ×—×©×•×‘ ×¢×œ ×–×”... ×–×” ×‘×¡×“×¨ ×œ×§×—×ª ×–××Ÿ! ğŸ¤”`,
                `×œ××˜ ×œ××˜, ××™×Ÿ ××¨×•×¥. ×‘×•×/×™ × ×¢×‘×•×¨ ×¢×œ ×–×” ×©×œ×‘ ××—×¨ ×©×œ×‘ ğŸ¢`,
                `× ×©××¢ ×§×¦×ª ××¡×•×‘×š? ×‘×•××• × ×¤×¨×§ ××ª ×–×” ×‘×™×—×“ ×œ×—×œ×§×™× ×§×˜× ×™× ğŸ§©`
            ];
        } else if (progress < 40) {
            return [
                `×›×™×•×•×Ÿ ×˜×•×‘! ×× ×™ ×¨×•××” ×©${name} ×¢×œ ×”××¡×œ×•×œ ×”× ×›×•×Ÿ ğŸ‘`,
                `×™×¤×”! ×™×© ×›××Ÿ ×”×ª×§×“××•×ª ×‘×¨×•×¨×” ğŸ“ˆ`,
                `××”×‘×ª×™ ××ª ×”×›×™×•×•×Ÿ ×”×–×”! ×ª××©×™×š/×™ ×›×›×” ğŸ’«`
            ];
        } else if (progress < 60) {
            return [
                `×•×•××•, ${name} ×××© ××ª×§×“×/×ª! ğŸŒŸ`,
                `×¨×•××”? ×”×ª×—×œ×ª ×œ×ª×¤×•×¡ ××ª ×–×”! ×–×” × ×”×“×¨ ğŸ¯`,
                `××™×–×” ×”×ª×§×“××•×ª! ×××© ××¨×’×©×™× ××•×ª×™ ğŸ’ª`
            ];
        } else if (progress < 85) {
            return [
                `${name} ×§×¨×•×‘/×” ×××•×“! ×”××©×š/×™ ×›×›×”! âœ¨`,
                `××ª×” ×›××¢×˜ ×©×! ×¨×§ ×¢×•×“ ×§×¦×ª ğŸš€`,
                `×™×©! ×× ×™ ××¨×’×™×©/×” ×©××ª×” ×¢×•××“/×ª ×œ×¤×¦×— ××ª ×–×” ğŸ”¥`
            ];
        } else {
            return [
                `××¢×•×œ×” ${name}! ×›××¢×˜ ×”×’×¢× ×•! ğŸ¯`,
                `××ª×” ×©×! ×¤×©×•×˜ ××•×©×œ× ğŸ’`,
                `×™×•×¤×™ ×©×œ ×™×•×¤×™! ×¢×›×©×™×• ×¨×§ ×œ×•×•×“× ×©×”×›×œ × ×›×•×Ÿ âœ…`
            ];
        }
    }

    getEncouragementForMistake(attemptNumber) {
        if (attemptNumber === 1) {
            return [
                `×–×” ×‘×¡×“×¨ ×’××•×¨! ×˜×¢×•×™×•×ª ×”×Ÿ ×—×œ×§ ××”×œ××™×“×” ğŸ’™`,
                `××™×Ÿ ×“×‘×¨ ×›×–×” ×˜×¢×•×ª - ×™×© ×¨×§ ××©×•×‘. ×‘×•× × ×¨××” ××™×¤×” ××¤×©×¨ ×œ×©×¤×¨ ğŸ”`,
                `×›×•×œ× ×˜×•×¢×™×! ×–×” ××™×š ×©×œ×•××“×™×. ×‘×•× × × ×¡×” ×©×•×‘ ×‘×™×—×“ ğŸ¤`
            ];
        } else if (attemptNumber === 2) {
            return [
                `×× ×™ ×¨×•××” ×©×™×© ×¤×” ××ª×’×¨. ×‘×•× ×× ×™ ××¢×–×•×¨ ×œ×š ×§×¦×ª ğŸ†˜`,
                `××•×§×™×™, ×× ×™ ××ª×Ÿ ×œ×š ×¨××– ×§×˜×Ÿ... ğŸ’¡`,
                `× ×¨××” ×©×¦×¨×™×š ×œ×’×©×ª ×œ×–×” ××—×¨×ª. ×‘×•× × ×—×©×•×‘ ×™×—×“ ğŸ§ `
            ];
        } else {
            return [
                `×‘×•× × ×¢×¦×•×¨ ×œ×¨×’×¢ ×•× ×¡×‘×™×¨ ××ª ×–×” ××”×”×ª×—×œ×” ğŸ“š`,
                `×ª×¨××”, ×”× ×•×©× ×”×–×” ×§×¦×ª ××¡×•×‘×š. ×‘×•× × ×¤×¨×§ ××•×ª×• ×œ×¦×¢×“×™× ×§×˜× ×™× ğŸªœ`,
                `×× ×™ ×¨×•××” ×©×–×” ×××ª×’×¨. ×‘×•× ×× ×™ ××¨××” ×œ×š ×“×•×’××” ×“×•××” ğŸ¬`
            ];
        }
    }

    // ==========================================
    // CLOSING PHASE - Reflective & Encouraging
    // ==========================================
    getClosingMessage(isCorrect, streak = 0, studentName = '') {
        const name = studentName || '××ª×”';

        if (isCorrect) {
            if (streak > 4) {
                return `ğŸ”¥ ×•×•××•! ×¨×¦×£ ×©×œ ${streak}! ${name} ×××© ×‘×•×¢×¨ ×”×™×•×! ğŸ”¥`;
            } else if (streak > 2) {
                return `×¨×¦×£ ×©×œ ${streak}! ${name} ×‘×§×¦×‘ ××¢×•×œ×”! ğŸ’ª`;
            } else {
                return [
                    `×›×œ ×”×›×‘×•×“ ${name}! ×¢×©×™×ª ×¢×‘×•×“×” ××¦×•×™× ×ª ğŸŒŸ`,
                    `×™×¤×” ×××•×“! ${name} ×‘×××ª ×”×‘×™×Ÿ/×” ××ª ×–×” âœ¨`,
                    `××•×©×œ×! ${name} ×¤×¦×— ××ª ×–×” ğŸ¯`,
                    `××™×–×” ×›×™×£ ×œ×¨××•×ª ××•×ª×š ××¦×œ×™×—! ğŸ’«`
                ];
            }
        } else {
            return [
                `×–×” ×‘×¡×“×¨ ×’××•×¨! ×œ×¤×¢××™× ×œ×•×§×— ×–××Ÿ ×œ×”×‘×™×Ÿ. ${name} ×¢×©×” ××××¥ ××¦×•×™×Ÿ ğŸ’™`,
                `×”×ª×©×•×‘×” ×œ× ××“×•×™×§×ª, ××‘×œ ×”×ª×”×œ×™×š ×©×œ×š ×”×™×” ×˜×•×‘! ×‘×•× × × ×¡×” ×©×•×‘ ğŸ”„`,
                `×›××¢×˜! ${name} ×”×™×” ×§×¨×•×‘ ×××•×“. ×¢×•×“ × ×™×¡×™×•×Ÿ ×§×˜×Ÿ ×•×× ×—× ×• ×©× ğŸ¯`
            ];
        }
    }

    getReflectiveQuestion(topic) {
        return [
            `××– ××” ×œ××“× ×• ×”×™×•× ×¢×œ ${topic}? ğŸ¤”`,
            `××™×š ${topic} ×§×©×•×¨ ×œ×“×‘×¨×™× ×©×›×‘×¨ ×™×“×¢×ª? ğŸ’­`,
            `××” ×”×™×” ×”×›×™ ××¢× ×™×™×Ÿ ×‘×ª×¨×’×™×œ ×”×–×”? â­`,
            `××™×š ×ª×¡×‘×™×¨ ××ª ${topic} ×œ×—×‘×¨/×” ×©×œ×š? ğŸ—£ï¸`
        ];
    }

    getProgressSummary(correct, total, topicsLearned) {
        const percentage = Math.round((correct / total) * 100);
        const topicsList = topicsLearned.join(', ');

        if (percentage >= 80) {
            return `ğŸ‰ ××—×œ×” ×¢×‘×•×“×”! ${correct} ××ª×•×š ${total} × ×›×•× ×™× (${percentage}%)! ×”×™×•× ×œ××“× ×•: ${topicsList}. ×××© ×’××” ×‘×š!`;
        } else if (percentage >= 60) {
            return `ğŸ’ª ×™×¤×”! ${correct} ××ª×•×š ${total} × ×›×•× ×™× (${percentage}%). ×¢×‘×“× ×• ×¢×œ: ${topicsList}. ××ª×” ××©×ª×¤×¨!`;
        } else {
            return `ğŸ“š ×¢×©×™× ×• ${total} ×ª×¨×’×™×œ×™× ×‘×™×—×“, ${correct} ×™×¦××• × ×›×•×Ÿ. × ×•×©××™×: ${topicsList}. ×–×” ×‘×¡×“×¨ - ×”×œ××™×“×” ×œ×•×§×—×ª ×–××Ÿ!`;
        }
    }

    // ==========================================
    // METACOGNITIVE QUESTIONS
    // ==========================================
    getMetacognitiveQuestion() {
        return [
            `××™×š ×™×“×¢×ª? ××” ×¢×–×¨ ×œ×š ×œ×”×’×™×¢ ×œ×ª×©×•×‘×”? ğŸ¤”`,
            `××” ×’×¨× ×œ×š ×œ×—×©×•×‘ ×›×›×”? ğŸ’­`,
            `×”×™×™×ª ×™×›×•×œ ×œ×¤×ª×•×¨ ××ª ×–×” ××—×¨×ª? ××™×š? ğŸ”„`,
            `××” ×”×™×” ×”×§×©×” ×‘×™×•×ª×¨ ×‘×ª×¨×’×™×œ ×”×–×”? ğŸ¯`,
            `×× ×”×™×™×ª ×¦×¨×™×š ×œ×”×¡×‘×™×¨ ××ª ×–×” ×œ××™×©×”×•, ××™×š ×”×™×™×ª ××ª×—×™×œ? ğŸ—£ï¸`
        ];
    }

    // ==========================================
    // WELCOME BACK - Session Resumption
    // ==========================================
    getWelcomeBackMessage(studentName, minutesInactive) {
        const name = studentName || '×©×œ×•×';

        if (minutesInactive < 30) {
            return `${name}, ×¨××™×ª×™ ×©×—×–×¨×ª! ğŸ‘‹ ×‘×•×/×™ × ××©×™×š ×××™×¤×” ×©×¢×¦×¨× ×•...`;
        } else if (minutesInactive < 120) {
            return `×‘×¨×•×š ×©×•×‘×š ${name}! ğŸŒŸ ×¨×•×¦×” ×©× ×¨×¢× ×Ÿ ×§×¦×ª ××ª ××” ×©×œ××“× ×•?`;
        } else {
            return `${name}! ×›××” ×–××Ÿ! ğŸ˜Š ×‘×•× × ×ª×—×™×œ ×¢× ××©×”×• ×§×œ ×›×“×™ ×œ×”×ª×—××...`;
        }
    }

    // ==========================================
    // HINT SYSTEM
    // ==========================================
    getHint(difficulty, attemptNumber) {
        if (difficulty === 'gentle') {
            return [
                `ğŸ’¡ ×¨××– ×§×˜×Ÿ: ×ª×¡×ª×›×œ/×™ ×¢×œ ×”×“×•×’××” ×©×œ××“× ×• ×œ×¤× ×™ ×–×”`,
                `ğŸ” ×—×©×•×‘/×™ ×¢×œ ×”×©×œ×‘ ×”×¨××©×•×Ÿ - ××” ×¦×¨×™×š ×œ×¢×©×•×ª ×§×•×“×?`,
                `âœ¨ ×™×© ×›××Ÿ ×“×¤×•×¡ - ××ª×” ×™×›×•×œ/×” ×œ××¦×•× ××•×ª×•?`
            ];
        } else if (difficulty === 'specific') {
            return [
                `ğŸ¯ ×‘×•× × ×—×©×•×‘ ×¨×’×¢ - ××™×–×” × ×•×¡×—×” ×¢×•×–×¨×ª ×œ× ×• ×¤×”?`,
                `ğŸ“ ××•×œ×™ ×›×“××™ ×œ×¤×¨×§ ××ª ×–×” ×œ×—×œ×§×™× ×§×˜× ×™× ×™×•×ª×¨?`,
                `ğŸ’ª ××” ×”×™×™× ×• ×¢×•×©×™× ×‘×ª×¨×’×™×œ ×”×“×•××” ××§×•×“×?`
            ];
        } else { // detailed
            return [
                `ğŸ”” ××•×§×™×™, ×‘×•× ×× ×™ ××¨××” ×œ×š ×‘×“×™×•×§ ××” ×œ×¢×©×•×ª...`,
                `ğŸ“š ×”× ×” ×“×•×’××” ×“×•××” ×¢× ×¤×ª×¨×•×Ÿ ××œ×:`,
                `ğŸ“ ×‘×•× × ×¢×©×” ××ª ×–×” ×©×œ×‘ ××—×¨ ×©×œ×‘ ×‘×™×—×“:`
            ];
        }
    }

    // ==========================================
    // TIME-BASED GREETINGS
    // ==========================================
    getTimeBasedGreeting(studentName = '') {
        const hour = new Date().getHours();
        const name = studentName || '×©×œ×•×';

        if (hour < 6) {
            return `${name}, ××ª×” ×œ× ×™×©×Ÿ/×”? ğŸ˜´ ×’× ××ª××˜×™×§×” ×™×›×•×œ×” ×œ×—×›×•×ª ×œ×‘×•×§×¨!`;
        } else if (hour < 12) {
            return `×‘×•×§×¨ ×˜×•×‘ ${name}! â˜€ï¸ ××™×–×” ×›×™×£ ×œ×”×ª×—×™×œ ××ª ×”×™×•× ×¢× ××ª××˜×™×§×”!`;
        } else if (hour < 18) {
            return `×©×œ×•× ${name}! ğŸŒ¤ï¸ ××•×›× ×™× ×œ××ª××˜×™×§×”?`;
        } else if (hour < 22) {
            return `×¢×¨×‘ ×˜×•×‘ ${name}! ğŸŒ† ×–××Ÿ ××¢×•×œ×” ×œ×œ××•×“!`;
        } else {
            return `${name}, ×××—×¨×™× ×œ×œ××•×“? ğŸŒ™ ×›×œ ×”×›×‘×•×“ ×¢×œ ×”××•×˜×™×‘×¦×™×”!`;
        }
    }

    // ==========================================
    // ADAPTIVE DIFFICULTY MESSAGES
    // ==========================================
    getSuggestionForStruggle(topicName) {
        return [
            `×× ×™ ×¨×•××” ×©-${topicName} ×§×¦×ª ×××ª×’×¨. ×¨×•×¦×” ×©× ×¢×‘×•×¨ ×¢×œ ×”×™×¡×•×“×•×ª ×©×•×‘? ğŸ”„`,
            `${topicName} ×“×•×¨×© ×ª×¨×’×•×œ. ×‘×•× × ×¢×©×” ×›××” ×“×•×’×××•×ª × ×•×¡×¤×•×ª ×‘×™×—×“ ğŸ’ª`,
            `× ×¨××” ×©-${topicName} ×¦×¨×™×š ×¢×•×“ ×—×™×–×•×§. ××™×Ÿ ×‘×¢×™×” - × ×©×§×™×¢ ×‘×–×” ×–××Ÿ ğŸ“š`
        ];
    }

    getSuggestionForMastery(topicName) {
        return [
            `×•×•××•! ××ª×” ×××© ×©×•×œ×˜ ×‘-${topicName}! ğŸŒŸ ×¨×•×¦×” ×œ× ×¡×•×ª ××©×”×• ×™×•×ª×¨ ×××ª×’×¨?`,
            `${topicName} - ××¦×•×™×Ÿ! ×‘×•× × ×¢×œ×” ×¨××” ×§×•×©×™? ğŸš€`,
            `××ª×” ×¤×•×¦×¥ ××ª ${topicName}! ××” ×“×¢×ª×š ×¢×œ × ×•×©× ×—×“×©? ğŸ¯`
        ];
    }

    // ==========================================
    // EMOTIONAL SUPPORT
    // ==========================================
    getEmotionalSupport(emotion) {
        switch(emotion) {
            case 'frustrated':
                return [
                    `×× ×™ ×¨×•××” ×©×–×” ××ª×¡×›×œ. ×–×” ×‘×¡×“×¨ ×œ×”×¨×’×™×© ×›×›×” ğŸ’™ ×‘×•× × ×§×— ×¤×¡×§ ×–××Ÿ ×§×˜×Ÿ?`,
                    `×ª×¨×’×™×©×• ×—×•×¤×©×™ ×œ×”×™×¢×–×¨ ×‘×™ ×‘×›×œ ×©×œ×‘. ×× ×™ ×¤×” ×‘×©×‘×™×œ×š ğŸ¤`,
                    `××ª××˜×™×§×” ×–×” ×œ× ×§×œ, ×•×–×” ×‘×¡×“×¨ ×œ×§×—×ª ××ª ×”×–××Ÿ ğŸŒ±`
                ];
            case 'confident':
                return [
                    `××™×–×” ×‘×™×˜×—×•×Ÿ! ×–×” × ×”×“×¨! ğŸ’ª`,
                    `×›×™×£ ×œ×¨××•×ª ××•×ª×š ××¨×’×™×©/×” ×‘×˜×•×—/×” ×¢× ×”×—×•××¨ ğŸŒŸ`,
                    `×›×Ÿ! ×–×” ×‘×“×™×•×§ ×”×¨×’×© ×©×¨×¦×™×ª×™ ×©×ª×—×•×•×” ğŸ¯`
                ];
            case 'confused':
                return [
                    `×–×” ×‘×¡×“×¨ ×œ×”×™×•×ª ××‘×•×œ×‘×œ/×ª. ×‘×•× × ×¢×¦×•×¨ ×•× ×‘×”×™×¨ ğŸ”`,
                    `×× ×™ ×¤×” ×‘×©×‘×™×œ×š. ××™×¤×” ×”×ª×‘×œ×‘×œ×ª? ğŸ’­`,
                    `×‘×•× × ×—×–×•×¨ ×¦×¢×“ ××—×•×¨×” ×•× ×¡×‘×™×¨ ×–××ª ××—×“×© ğŸ“š`
                ];
            default:
                return `××™×š ××ª×” ××¨×’×™×©/×” ×¢× ×”×—×•××¨? ğŸ¤”`;
        }
    }

    // ==========================================
    // UTILITY METHODS
    // ==========================================
    setPhase(phase) {
        this.lessonPhase = phase;
    }

    getRandomItem(array) {
        if (Array.isArray(array[0])) {
            // Nested array - flatten and pick
            return array[Math.floor(Math.random() * array.length)];
        }
        return array[Math.floor(Math.random() * array.length)];
    }

    updateLastInteraction() {
        this.lastInteraction = Date.now();
    }

    getInactiveMinutes() {
        return (Date.now() - this.lastInteraction) / 1000 / 60;
    }
}

// Create singleton instance
const nexonPersonality = new NexonPersonality();

export default nexonPersonality;

// Named exports for convenience
export const {
    getOpeningMessage,
    getOpeningQuestion,
    getMiddleMessage,
    getEncouragementForMistake,
    getClosingMessage,
    getReflectiveQuestion,
    getMetacognitiveQuestion,
    getWelcomeBackMessage,
    getHint,
    getTimeBasedGreeting,
    getSuggestionForStruggle,
    getSuggestionForMastery,
    getEmotionalSupport
} = nexonPersonality;